{% extends "layout.html" %}

{% block title %}Scan Detail{% endblock %}

{% block content %}
<div class="card detail-header">
    <div class="target-info">
        <h1>
            <span id="target-name">Loading...</span>
            <span id="scan-status-badge" class="badge badge-running">...</span>
        </h1>
        <div class="meta-info">
            <div class="meta-item">
                <i class="fa-regular fa-clock"></i>
                <span id="scan-time">...</span>
            </div>
            <div class="meta-item">
                <i class="fa-solid fa-hourglass-half"></i>
                <span id="scan-duration">...</span>
            </div>
            <div class="meta-item">
                <i class="fa-solid fa-fingerprint"></i>
                <span id="scan-id">...</span>
            </div>
        </div>
    </div>

    <div class="large-score">
        <div class="score-circle" id="risk-circle">
            ---
        </div>
        <div class="score-label" id="risk-label">Risk Score</div>
    </div>
</div>

<div class="grid-layout detail-grid">
    <div class="main-column">
        <!-- Charts -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="section-header">
                <h3 class="section-title">Vulnerability Breakdown</h3>
            </div>
            <div style="height: 300px; width: 100%;">
                <canvas id="detailChart"></canvas>
            </div>
        </div>

        <!-- Vulnerabilities List -->
        <div class="section-header">
            <h3 class="section-title">Findings</h3>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-sm btn-outline" id="json-toggle">View JSON</button>
            </div>
        </div>

        <div id="findings-list">
            <!-- Populated via JS -->
            <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                Analyzing scan results...
            </div>
        </div>

        <div id="json-view" style="display: none; margin-top: 1rem;">
            <div class="raw-json-viewer" id="json-content"></div>
        </div>
    </div>

    <div class="side-column">
        <!-- Open Ports -->
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="section-header">
                <h3 class="section-title">Open Ports</h3>
                <span class="badge" id="port-count">0</span>
            </div>
            <div id="ports-list" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                <span style="color: var(--text-muted); font-size: 0.875rem;">No open ports data</span>
            </div>
        </div>

        <!-- Scan Actions -->
        <div class="card">
            <h3 class="section-title" style="margin-bottom: 1rem;">Actions</h3>
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <button class="btn btn-primary" id="retry-btn">
                    <i class="fa-solid fa-refresh"></i> Re-Scan Target
                </button>
                <button class="btn btn-outline" onclick="window.print()">
                    <i class="fa-solid fa-print"></i> Print Report
                </button>
                <button class="btn btn-danger" id="delete-btn">
                    <i class="fa-solid fa-trash"></i> Delete Scan
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/scan_detail.js"></script>
{% endblock %}